---
title: "Assignment1 msb104 group5"
author: Frida Alendal og Katinca Valvatne 
lang: NO_nb
editor: visual
toc: true
number-sections: true
format:
  html:
    df-print: paged
  pdf:
    geometry: margin=2.5cm
    keep-tex: false
execute:
  echo: true      # vis kode
  warning: false  # skjul advarsler i output
  message: false  # skjul meldinger i output
---

```{r}
#| label: setup
# Globale innstillinger og pakker
knitr::opts_chunk$set(fig.align = "center", fig.width = 7, fig.height = 4.5, dpi = 300)

# install.packages(c("tidyverse","janitor","eurostat","dineq")) # kjør én gang ved behov
library(tidyverse)
library(janitor)
library(stringr)
```


# Del A: Subnasjonalt BNP og BNP per innbygger

## Data og deskriptiv statistikk 
Vi analyserer perioden **2000-2023** for **Spania (ES), Østerrike (AT), Tsjekkia (CZ), Slovenia (SI)** og **Estland (EE)** på **NUTS-3**-nivå. Data ble lastet ned fra Eurostat som tilpassede "Spreadsheet CSV"-filer den **28.10.25**. Vi beregner **BNP per innbygger (GDPC)** som BNP i euro delt på totalt innbyggertall. Eventuelle datamerker/"flagg" (f.eks. *p* for foreløpig) beholdes som referanse, mens elve beregningen bruker tallverdiene.

### BNP (nama_10r_3gdp)
Regionalt BNP hentes fra **`nama_10r_3gdp`** med **`na_item = B1GQ`** (BNP i markedspriser) og **`unit = MIO_EUR`** (millioner euro). Tallene er årlige og rapporteres på NUTS-3. Eurostat fordeler nasjonale skatter/subsidier på produkter til regioner i tråd med metodikken i regionale nasjonalregnskaper. Aktivitet som ikke kan knyttes til en bestemt region håndteres som **extra-regio**. Serien kan inneholde **revisjoner** og mindre **brudd** (bl.a. oppdateringer i NUTS-klassifikasjon), så små sprang mellom år kan forekomme. 

### Befolkning (demo_r_pjanaggr3)
Befolning hentes fra **`demo_r_pjanaggr3`** med **`sex = T`** (totalt) og **`age = TOTAL`** (alle aldre). Populasjonsbegrepet er **vanlig bosted** (*ususal residence*) og referansetidspunktet er **1. januar** hvert år. Verdiene er oppgitt i **personer**. Kombinert med BNP-tabellen gir dette et konsistent grunnlag for å beregne **GDPC** på tvers av land og regioner i hele analyseperioden  


## Beregning av BNP per innbygger (GDP per Capita Calculation)


```{r}
# 1) Les inn på nytt – ALT som tekst, hopp over header-rader
BNP_MIO_Eur <- read_excel(
  "nama_10r_3gdp__custom_18648452_spreadsheet_uten_flags.xlsx",
  col_types = "text",
  skip = 2
) |>
  clean_names() |>
  rename(
    geo_kode = 1,   # dette er TIME...1 i arket ditt
    geo_navn = 2    # dette er TIME...2
  )
# 2) Gjør bredt -> langt og parse til tall
gdp_long <- BNP_MIO_Eur |>
  filter(!str_detect(geo_kode, "^GEO")) |>     # fjern evt. "GEO (Codes)"-rader
  pivot_longer(
    cols = -c(geo_kode, geo_navn),             # ALLE årskolonner
    names_to  = "ar",
    values_to = "gdp_mio_eur"
  ) |>
  mutate(
    ar          = readr::parse_number(ar),         # "2003" -> 2003
    gdp_mio_eur = readr::parse_number(gdp_mio_eur) # "23 859,75"/":" -> 23859.75/NA
  )
```



```{r}
# laste inn datasett 1, BNP i millioner euro:

BNP_MIO_Eur <- read_excel("nama_10r_3gdp__custom_18648452_spreadsheet_uten_flags.xlsx")

# gjør alle navn til tekst
names(BNP_MIO_Eur) <- as.character(names(BNP_MIO_Eur))

# Legge til korrekt årstall og navn på variabler:

names(BNP_MIO_Eur) <- c("Geo_Kode", "Geo_Navn", 2000:2023)

# Finn alle årskolonner trygt (2000–2023 kan være '2000' eller 'x2000' etter clean_names)
year_cols <- grep("^x?\\d{4}$", names(BNP_MIO_Eur), value = TRUE)

# ---- 2) Bred -> lang + "samme opprydding som Pop" ----
BNP <- BNP_MIO_Eur %>%
  # gi fornuftige navn på de to første kolonnene om nødvendig
  rename(Geo_kode = 1, Geo_navn = 2) %>%
  # fjern header-rader som ble lest som data (samme som Pop)
  filter(!str_detect(Geo_kode, "^GEO"), Geo_navn != "GEO (Labels)") %>%
  # gjør årskolonnene lange
  pivot_longer(
    cols = all_of(year_cols),
    names_to  = "År",
    values_to = "BNP_mill_Euro"
  ) %>%
  # sikre riktige typer (samme stil som Pop)
  mutate(
    År            = parse_number(År),            # "x2003"/"2003" -> 2003
    BNP_mill_Euro = parse_number(BNP_mill_Euro)  # "23 859,75" / ":" -> 23859.75 / NA
  )
```
```{r}
# laste inn datasett 2, befolkning per 1. januar:

Pop <- read_excel("demo_r_pjanaggr3__custom_18648204_spreadsheet_uten_flags.xlsx")

# legge til korrekt årstall og navn på variabler:

names(Pop) <- c("Geo_kode", "Geo_navn", 2000:2023)

# Gjøre datasettet tidy:

Pop <- Pop |> pivot_longer(col = c(3:26), names_to = "År", values_to = "Befolkning")

library(dplyr)
library(stringr)
library(readr)

Pop <- Pop %>%
  # fjern header-radene som ble lest som data
  filter(!str_detect(Geo_kode, "^GEO"), Geo_navn != "GEO (Labels)") %>%
  # sikre typer
  mutate(
    År = as.integer(År),
    Befolkning = parse_number(Befolkning)  # "1 234 567" / ":" -> 1234567 / NA
  )

```


```{r}
# vis de første radene
BNP_MIO_Eur |> dplyr::slice_head(n = 10)

```

```{r}
# Viser de første radene
Pop |> dplyr::slice_head(n = 10)
```















